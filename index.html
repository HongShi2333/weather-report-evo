<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>çº¢çŸ³å¤©æ°” - é€æ˜è§†æ•ˆç‰ˆ</title>

  <link rel="icon" type="image/webp" href="img.webp" />
  <meta name="color-scheme" content="dark light" />

  <style>
    :root {
      /* é™ä½èƒŒæ™¯æµ“åº¦ï¼Œæå‡é€æ˜åº¦ï¼Œè®©å£çº¸é€å‡ºæ¥ */
      --glass: rgba(255, 255, 255, 0.04); 
      --glass-2: rgba(0, 0, 0, 0.15);
      --stroke: rgba(255, 255, 255, 0.12);
      --shadow: 0 20px 50px rgba(0, 0, 0, 0.25);
      --text: rgba(255, 255, 255, 0.95);
      --muted: rgba(255, 255, 255, 0.7);
      --muted-2: rgba(255, 255, 255, 0.5);
      --radius-xl: 28px;
      --radius-lg: 20px;
      --max: 1100px;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --vh: 1vh;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { height: 100%; margin: 0; }
    body {
      font-family: ui-sans-serif, system-ui, -apple-system, sans-serif;
      color: var(--text);
      overflow-x: hidden;
      background: #080c14;
    }

    /* èƒŒæ™¯å±‚ */
    .bgWrap { position: fixed; inset: 0; z-index: -3; overflow: hidden; background: #000; }
    .bgLayer {
      position: absolute; inset: 0; background: center / cover no-repeat;
      transform: scale(1.05); opacity: 0;
      transition: opacity 1200ms cubic-bezier(0.4, 0, 0.2, 1), transform 1200ms ease-out;
      will-change: opacity, transform;
    }
    .bgLayer.on { opacity: 1; transform: scale(1); }
    .bgWrap::after {
      content: ""; position: absolute; inset: 0;
      background: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.4));
      z-index: 2; pointer-events: none;
    }

    /* HUDï¼šè§£å†³ç§»åŠ¨ç«¯é®æŒ¡ */
    .hud { position: fixed; top: calc(12px + var(--safe-top)); left: 0; right: 0; z-index: 50; pointer-events: none; }
    .hud-inner { width: min(var(--max), calc(100% - 24px)); margin: 0 auto; display: flex; justify-content: space-between; gap: 8px; }
    .pill {
      pointer-events: auto; display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 14px; border-radius: 999px; background: var(--glass-2);
      border: 1px solid var(--stroke); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    }
    .pill .k { color: var(--muted-2); font-size: 11px; text-transform: uppercase; }
    .pill .v { font-size: 13px; font-weight: 650; white-space: nowrap; }
    .pill .dot { width: 6px; height: 6px; border-radius: 50%; background: #4effae; flex-shrink: 0; }

    @media (max-width: 520px) {
      .pill .k { display: none; } /* ç§»åŠ¨ç«¯éšè—æ ‡ç­¾ï¼Œåªç•™æ ¸å¿ƒä¿¡æ¯ */
      .pill .v { font-size: 12px; font-family: monospace; }
    }

    main { width: min(var(--max), calc(100% - 28px)); margin: 0 auto; padding: calc(80px + var(--safe-top)) 0 calc(20px + var(--safe-bottom)); }

    /* å¡ç‰‡ï¼šæè‡´é€æ˜ */
    .card {
      border-radius: var(--radius-xl); background: var(--glass); border: 1px solid var(--stroke);
      box-shadow: var(--shadow); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
      overflow: hidden; position: relative;
    }
    .hero-grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 20px; padding: 24px; }

    .title h1 { margin: 0; font-size: clamp(24px, 4vw, 34px); font-weight: 800; }
    .subtitle { margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap; }
    .badge { padding: 4px 10px; border-radius: 999px; background: rgba(0,0,0,0.25); border: 1px solid var(--stroke); font-size: 11px; color: var(--muted); }

    .now { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; }
    .temp .big { font-size: clamp(56px, 9vw, 80px); font-weight: 900; line-height: 1; }
    .temp .feel { color: var(--muted); font-size: 14px; margin-top: 6px; }
    .cond { text-align: right; }
    .icon { font-size: 48px; margin-bottom: 4px; width: 64px; height: 64px; background: rgba(255,255,255,0.08); border-radius: 20px; display: inline-grid; place-items: center; }

    .metrics { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
    .metric { padding: 16px; border-radius: var(--radius-lg); background: rgba(0,0,0,0.15); border: 1px solid var(--stroke); }
    .metric .v { font-size: 18px; font-weight: 800; margin: 4px 0; }
    .metric .k, .metric .s { font-size: 11px; color: var(--muted); }

    .side { display: flex; flex-direction: column; gap: 12px; }
    .mini { padding: 14px; border-radius: var(--radius-lg); background: rgba(0,0,0,0.15); border: 1px solid var(--stroke); }
    .mini .k { font-size: 11px; color: var(--muted); }
    .mini .v { font-size: 18px; font-weight: 800; margin-top: 4px; }
    .mini .t { font-size: 11px; color: var(--muted-2); margin-top: 4px; }

    /* ä¸‹æ»‘æç¤º */
    .scroll-hint { margin: 15px auto 0; width: fit-content; padding: 10px 20px; border-radius: 999px; background: rgba(0,0,0,0.3); border: 1px solid var(--stroke); font-size: 13px; color: var(--muted); backdrop-filter: blur(8px); animation: floaty 2s infinite; cursor: pointer; }
    @keyframes floaty { 0%,100% { transform:translateY(0); } 50% { transform:translateY(5px); } }

    /* æœªæ¥å¤©æ°”è¯¦æƒ…æ ·å¼æ¢å¤ */
    .section { margin-top: 30px; }
    .grid-days { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
    .day { padding: 20px; border-radius: var(--radius-xl); background: var(--glass); border: 1px solid var(--stroke); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); }
    .day .top { display: flex; justify-content: space-between; align-items: center; }
    .day .date { font-weight: 800; font-size: 16px; }
    .day .mid { display: flex; justify-content: space-between; align-items: center; margin: 15px 0; }
    .day .t { font-size: 28px; font-weight: 900; }
    .day .range { font-size: 12px; color: var(--muted); margin-top: 4px; }
    .day .bot { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .chip { padding: 8px; border-radius: 12px; background: rgba(0,0,0,0.2); border: 1px solid var(--stroke); font-size: 11px; color: var(--muted); display: flex; justify-content: space-between; }
    .chip b { color: #fff; }

    /* åŠ è½½å±‚ï¼šåŠ å…¥æŸ”å’Œç¼©æ”¾ */
    .overlay {
      position: fixed; inset: 0; z-index: 100; display: grid; place-items: center;
      background: rgba(0,0,0,0.7); backdrop-filter: blur(15px);
      transition: all 0.6s cubic-bezier(0.22, 1, 0.36, 1);
    }
    .overlay.hidden { opacity: 0; visibility: hidden; transform: scale(1.08); }
    .loadCard { width: min(400px, 90%); padding: 30px; background: var(--glass); border: 1px solid var(--stroke); border-radius: var(--radius-xl); text-align: center; }
    .ring { width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.1); border-top-color: #fff; border-radius: 50%; margin: 0 auto 20px; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    @media (max-width: 920px) { .hero-grid { grid-template-columns: 1fr; } .metrics { grid-template-columns: 1fr; } .grid-days { grid-template-columns: 1fr; } }
  </style>
</head>

<body>
  <div class="bgWrap" aria-hidden="true">
    <div class="bgLayer" id="bgA"></div>
    <div class="bgLayer" id="bgB"></div>
  </div>

  <div class="hud">
    <div class="hud-inner">
      <div class="pill">
        <span class="dot"></span>
        <div class="v" id="ipLine">å®šä½ä¸­â€¦</div>
      </div>
      <div class="pill">
        <div class="k">Time</div>
        <div class="v" id="clock">â€”</div>
      </div>
    </div>
  </div>

  <div class="overlay" id="overlay">
    <div class="loadCard">
      <div class="ring"></div>
      <div style="font-weight:800; font-size:18px; margin-bottom:8px;">æ­£åœ¨åŒæ­¥å¤§æ°”æ•°æ®</div>
      <div style="font-size:13px; color:var(--muted);">æ­£åœ¨æ¥å…¥çº¢çŸ³é•œåƒæº...</div>
      <div id="errBox" style="display:none; margin-top:15px; font-size:12px; color:#ff8e8e;"></div>
      <div class="actions" style="margin-top:20px; display:flex; gap:10px; justify-content:center;">
        <button onclick="location.reload()" style="padding:8px 20px; border-radius:99px; border:1px solid #fff; background:none; color:#fff; cursor:pointer;">é‡è¯•</button>
        <button onclick="document.getElementById('overlay').classList.add('hidden')" style="padding:8px 20px; border-radius:99px; border:none; background:rgba(255,255,255,0.1); color:#fff; cursor:pointer;">è·³è¿‡</button>
      </div>
    </div>
  </div>

  <main>
    <section class="hero">
      <div class="card">
        <div class="hero-grid">
          <div class="main-info">
            <div class="title">
              <h1 id="headline">çº¢çŸ³å¤©æ°”</h1>
              <div class="subtitle">
                <span class="badge" id="placeBadge">Locating...</span>
                <span class="badge" id="sourceBadge">Source: Mirror</span>
              </div>
            </div>
            <div class="now">
              <div class="temp">
                <div class="big" id="tempNow">â€”Â°</div>
                <div class="feel" id="feelNow">ä½“æ„Ÿï¼šâ€” Â· æ¹¿åº¦ï¼šâ€”</div>
              </div>
              <div class="cond">
                <div class="icon" id="emojiIcon">â›…</div>
                <div id="condNow" style="font-weight:800; font-size:18px;">â€”</div>
              </div>
            </div>
            <div class="metrics">
              <div class="metric">
                <div class="k">ğŸŒ¬ï¸ é£é€Ÿ</div>
                <div class="v" id="windNow">â€”</div>
                <div class="s" id="windHint">æ­£åœ¨è®¡ç®—</div>
              </div>
              <div class="metric">
                <div class="k">ğŸŒ§ï¸ é™æ°´</div>
                <div class="v" id="rainNow">â€”</div>
                <div class="s" id="rainHint">ä»Šæ—¥æ¦‚ç‡</div>
              </div>
              <div class="metric">
                <div class="k">ğŸ‘ï¸ èƒ½è§åº¦</div>
                <div class="v" id="visNow">â€”</div>
                <div class="s" id="visHint">ç©ºæ°”é€æ˜åº¦</div>
              </div>
            </div>
          </div>
          <aside class="side">
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
              <div class="mini">
                <div class="k">æ¸©å·®èŒƒå›´</div>
                <div class="v" id="hiLo">â€”</div>
                <div class="t" id="uv">UV: â€”</div>
              </div>
              <div class="mini">
                <div class="k">æ°”å‹</div>
                <div class="v" id="pressure">â€”</div>
                <div class="t" id="cloud">äº‘é‡: â€”</div>
              </div>
            </div>
            <div class="mini">
              <div class="k">æ—¥å‡ºæ—¥è½</div>
              <div class="v" id="sun">â€”</div>
              <div class="t" id="moon">æœˆç›¸: â€”</div>
            </div>
            <div class="mini" style="background:rgba(255,255,255,0.06);">
              <div class="k">ç”Ÿæ´»å»ºè®®</div>
              <div class="v" id="adviceTitle" style="font-size:16px;">â€”</div>
              <div class="t" id="adviceText">â€”</div>
            </div>
          </aside>
        </div>
      </div>
      <div class="scroll-hint" id="scrollHint"><span>ä¸‹æ»‘æŸ¥çœ‹æœªæ¥ 48 å°æ—¶é¢„æŠ¥</span></div>
    </section>

    <section class="section" id="future">
      <div style="margin-bottom:15px; font-weight:800; font-size:18px; padding-left:10px;">è¶‹åŠ¿è¯¦æƒ…é¢„æŠ¥</div>
      <div class="grid-days" id="days"></div>
    </section>
  </main>

  <script>
    const LOCATION_API = "https://hongshi819-location.hf.space/";
    const WEATHER_BASE = "https://weather.hongshi.de5.net/";
    const BG_MAX_MOBILE = 33, BG_MAX_DESKTOP = 18;

    const setText = (id, val) => { const el = document.getElementById(id); if(el) el.textContent = val; };
    const pad = (n) => String(n).padStart(2, '0');

    function tick() {
      const d = new Date();
      setText('clock', `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`);
    }
    setInterval(tick, 1000); tick();

    let bgToggle = true;
    async function swapBg() {
      const isMob = window.innerWidth < 920;
      const dir = isMob ? "mobile/" : "desktop/";
      const prefix = isMob ? "m-background" : "d-background";
      const idx = Math.floor(Math.random() * (isMob ? BG_MAX_MOBILE : BG_MAX_DESKTOP)) + 1;
      const url = `${dir}${prefix}${idx}.jpg?v=${Date.now()}`;
      const img = new Image();
      img.src = url;
      img.onload = () => {
        const on = bgToggle ? document.getElementById('bgA') : document.getElementById('bgB');
        const off = bgToggle ? document.getElementById('bgB') : document.getElementById('bgA');
        off.style.backgroundImage = `url(${url})`;
        off.classList.add('on');
        on.classList.remove('on');
        bgToggle = !bgToggle;
      };
    }
    setInterval(swapBg, 25000); swapBg();

    async function init() {
      try {
        const loc = await (await fetch(LOCATION_API)).json();
        const regions = loc.regions_short || loc.regions || [];
        const city = regions[1] || "æœªçŸ¥ä½ç½®";
        setText('ipLine', loc.ip);
        setText('placeBadge', regions.join(' Â· '));
        setText('headline', `${city} Â· ä»Šæ—¥çŠ¶å†µ`);

        const weather = await (await fetch(`${WEATHER_BASE}${encodeURIComponent(city)}?format=j1&lang=zh`)).json();
        render(weather);
        setTimeout(() => document.getElementById('overlay').classList.add('hidden'), 500);
      } catch (e) {
        document.getElementById('errBox').style.display = 'block';
        setText('errBox', `åŒæ­¥å¤±è´¥: ${e.message}`);
      }
    }

    function codeToEmoji(code) {
      const c = String(code);
      if (c.startsWith("1")) return "â˜€ï¸";
      if (c.startsWith("2")) return "â›ˆï¸";
      if (c.startsWith("3")) return "ğŸŒ§ï¸";
      return "â›…";
    }

    function render(w) {
      const cur = w.current_condition[0];
      const today = w.weather[0];
      setText('tempNow', `${cur.temp_C}Â°`);
      setText('feelNow', `ä½“æ„Ÿ ${cur.FeelsLikeC}Â° Â· æ¹¿åº¦ ${cur.humidity}%`);
      setText('condNow', cur.weatherDesc[0].value);
      setText('emojiIcon', codeToEmoji(cur.weatherCode));
      setText('windNow', `${cur.windspeedKmph}km/h`);
      setText('windHint', `é£å‘: ${cur.winddir16Point}`);
      setText('rainNow', `${today.hourly[0].chanceofrain}%`);
      setText('visNow', `${cur.visibility}km`);
      setText('hiLo', `${today.maxtempC}Â° / ${today.mintempC}Â°`);
      setText('pressure', `${cur.pressure}hPa`);
      setText('cloud', `${cur.cloudcover}%`);
      setText('sun', `${today.astronomy[0].sunrise} / ${today.astronomy[0].sunset}`);
      setText('moon', today.astronomy[0].moon_phase);
      
      const t = parseInt(cur.temp_C);
      setText('adviceTitle', t > 28 ? "å»ºè®®é¿æš‘" : t > 15 ? "æ°”æ¸©èˆ’é€‚" : "æ³¨æ„ä¿æš–");
      setText('adviceText', `å½“å‰å®æ—¶è§‚æµ‹æ—¶é—´: ${cur.observation_time}`);

      const days = document.getElementById('days');
      days.innerHTML = '';
      w.weather.slice(1,3).forEach(d => {
        const pick = d.hourly[4]; 
        const div = document.createElement('div');
        div.className = 'day';
        div.innerHTML = `
          <div class="top">
            <div class="date">${d.date}</div>
            <div style="font-size:12px; color:var(--muted);">${pick.weatherDesc[0].value}</div>
          </div>
          <div class="mid">
            <div>
              <div class="t">${d.avgtempC}Â°</div>
              <div class="range">æœ€é«˜ ${d.maxtempC}Â° / æœ€ä½ ${d.mintempC}Â°</div>
            </div>
            <div class="icon" style="width:50px; height:50px; font-size:32px;">${codeToEmoji(pick.weatherCode)}</div>
          </div>
          <div class="bot">
            <div class="chip"><span>é™é›¨æ¦‚ç‡</span><b>${pick.chanceofrain}%</b></div>
            <div class="chip"><span>å¹³å‡æ¹¿åº¦</span><b>${pick.humidity}%</b></div>
            <div class="chip"><span>ä¸­åˆé£é€Ÿ</span><b>${pick.windspeedKmph}k/h</b></div>
            <div class="chip"><span>èƒ½è§åº¦</span><b>${pick.visibility}km</b></div>
          </div>
        `;
        days.appendChild(div);
      });
    }

    document.getElementById('scrollHint').onclick = () => document.getElementById('future').scrollIntoView({behavior:'smooth'});
    init();
  </script>
</body>
</html>