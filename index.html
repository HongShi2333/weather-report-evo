<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>çº¢çŸ³å¤©æ°”</title>

  <link rel="icon" type="image/webp" href="img.webp" />
  <meta name="color-scheme" content="dark light" />

    <link rel="stylesheet" href="weather.css">

</head>

<body>
  <div class="bgWrap" aria-hidden="true">
    <div class="bgLayer" id="bgA"></div>
    <div class="bgLayer" id="bgB"></div>
  </div>

  <div class="hud">
    <div class="hud-inner">
      <div class="pill">
        <span class="dot"></span>
        <div class="v" id="ipLine">å®šä½ä¸­â€¦</div>
      </div>
      <div class="pill">
        <div class="k">Time</div>
        <div class="v" id="clock">â€”</div>
      </div>

      <a class="pill github" href="https://github.com/HongShi2333/weather-report-evo/" target="_blank" rel="noopener" aria-label="Open GitHub Repository">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="currentColor" d="M12 .5C5.73.5.75 5.73.75 12.2c0 5.22 3.44 9.64 8.2 11.2.6.12.82-.27.82-.58v-2.16c-3.34.75-4.04-1.46-4.04-1.46-.55-1.45-1.34-1.84-1.34-1.84-1.1-.78.08-.77.08-.77 1.22.09 1.86 1.28 1.86 1.28 1.08 1.9 2.84 1.35 3.53 1.03.11-.8.42-1.35.76-1.66-2.67-.31-5.48-1.39-5.48-6.2 0-1.37.46-2.49 1.22-3.37-.12-.31-.53-1.57.12-3.28 0 0 1.01-.33 3.3 1.29.96-.27 1.99-.4 3.01-.41 1.02.01 2.05.14 3.01.41 2.29-1.62 3.3-1.29 3.3-1.29.65 1.71.24 2.97.12 3.28.76.88 1.22 2 1.22 3.37 0 4.82-2.82 5.89-5.5 6.19.43.38.82 1.13.82 2.29v3.4c0 .32.22.71.82.58 4.76-1.56 8.2-5.98 8.2-11.2C23.25 5.73 18.27.5 12 .5z"/>
        </svg>
        <div class="v">GitHub</div>
      </a>

    </div>
  </div>

  <div class="overlay" id="overlay">
    <div class="loadCard">
      <div class="ring"></div>
      <div style="font-weight:800; font-size:18px; margin-bottom:8px;">æ­£åœ¨åŒæ­¥å¤§æ°”æ•°æ®</div>
      <div style="font-size:13px; color:var(--muted);">æ­£åœ¨æ¥å…¥çº¢çŸ³é•œåƒæº...</div>
      <div id="errBox" style="display:none; margin-top:15px; font-size:12px; color:#ff8e8e;"></div>
      <div class="actions" style="margin-top:20px; display:flex; gap:10px; justify-content:center;">
        <button onclick="location.reload()" style="padding:8px 20px; border-radius:99px; border:1px solid #fff; background:none; color:#fff; cursor:pointer;">é‡è¯•</button>
        <button onclick="document.getElementById('overlay').classList.add('hidden')" style="padding:8px 20px; border-radius:99px; border:none; background:rgba(255,255,255,0.1); color:#fff; cursor:pointer;">è·³è¿‡</button>
      </div>
    </div>
  </div>

  <main>
    <section class="hero">
      <div class="card">
        <div class="hero-grid">
          <div class="main-info">
            <div class="title">
              <h1 id="headline">çº¢çŸ³å¤©æ°”</h1>
              <div class="subtitle">
                <span class="badge" id="placeBadge">Locating...</span>
                <span class="badge" id="sourceBadge">Source: Mirror</span>
              </div>
            </div>
            <div class="now">
              <div class="temp">
                <div class="big" id="tempNow">â€”Â°</div>
                <div class="feel" id="feelNow">ä½“æ„Ÿï¼šâ€” Â· æ¹¿åº¦ï¼šâ€”</div>
              </div>
              <div class="cond">
                <div class="icon" id="emojiIcon">â›…</div>
                <div id="condNow" style="font-weight:800; font-size:18px;">â€”</div>
              </div>
            </div>
            <div class="metrics">
              <div class="metric">
                <div class="k">ğŸŒ¬ï¸ é£é€Ÿ</div>
                <div class="v" id="windNow">â€”</div>
                <div class="s" id="windHint">æ­£åœ¨è®¡ç®—</div>
              </div>
              <div class="metric">
                <div class="k">ğŸŒ§ï¸ é™æ°´</div>
                <div class="v" id="rainNow">â€”</div>
                <div class="s" id="rainHint">ä»Šæ—¥æ¦‚ç‡</div>
              </div>
              <div class="metric">
                <div class="k">ğŸ‘ï¸ èƒ½è§åº¦</div>
                <div class="v" id="visNow">â€”</div>
                <div class="s" id="visHint">ç©ºæ°”é€æ˜åº¦</div>
              </div>
            </div>
          </div>
          <aside class="side">
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
              <div class="mini">
                <div class="k">æ¸©å·®èŒƒå›´</div>
                <div class="v" id="hiLo">â€”</div>
                <div class="t" id="uv">UV: â€”</div>
              </div>
              <div class="mini">
                <div class="k">æ°”å‹</div>
                <div class="v" id="pressure">â€”</div>
                <div class="t" id="cloud">äº‘é‡: â€”</div>
              </div>
            </div>
            <div class="mini">
              <div class="k">æ—¥å‡ºæ—¥è½</div>
              <div class="v" id="sun">â€”</div>
              <div class="t" id="moon">æœˆç›¸: â€”</div>
            </div>
            <div class="mini" style="background:rgba(255,255,255,0.06);">
              <div class="k">ç”Ÿæ´»å»ºè®®</div>
              <div class="v" id="adviceTitle" style="font-size:16px;">â€”</div>
              <div class="t" id="adviceText">â€”</div>
            </div>
          </aside>
        </div>
      </div>
      <div class="scroll-hint" id="scrollHint"><span>ä¸‹æ»‘æŸ¥çœ‹æœªæ¥ 48 å°æ—¶é¢„æŠ¥</span></div>
    </section>

    <section class="section" id="future">
      <div style="margin-bottom:15px; font-weight:800; font-size:18px; padding-left:10px;">è¶‹åŠ¿è¯¦æƒ…é¢„æŠ¥</div>
      <div class="grid-days" id="days"></div>
    </section>
  </main>

  <script>
    const LOCATION_API = "https://hongshi819-location.hf.space/";
    const WEATHER_BASE = "https://weather.hongshi.de5.net/";
    const BG_MAX_MOBILE = 33, BG_MAX_DESKTOP = 18;

    const setText = (id, val) => { const el = document.getElementById(id); if(el) el.textContent = val; };
    const pad = (n) => String(n).padStart(2, '0');

    function tick() {
      const d = new Date();
      setText('clock', `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`);
    }
    setInterval(tick, 1000); tick();

    let bgToggle = true;
    async function swapBg() {
      const isMob = window.innerWidth < 920;
      const dir = isMob ? "mobile/" : "desktop/";
      const prefix = isMob ? "m-background" : "d-background";
      const idx = Math.floor(Math.random() * (isMob ? BG_MAX_MOBILE : BG_MAX_DESKTOP)) + 1;
      const url = `${dir}${prefix}${idx}.jpg?v=${Date.now()}`;
      const img = new Image();
      img.src = url;
      img.onload = () => {
        const on = bgToggle ? document.getElementById('bgA') : document.getElementById('bgB');
        const off = bgToggle ? document.getElementById('bgB') : document.getElementById('bgA');
        off.style.backgroundImage = `url(${url})`;
        off.classList.add('on');
        on.classList.remove('on');
        bgToggle = !bgToggle;
      };
    }
    setInterval(swapBg, 25000); swapBg();

    async function init() {
      try {
        const loc = await (await fetch(LOCATION_API)).json();
        const regions = loc.regions_short || loc.regions || [];
        const city = regions[1] || "æœªçŸ¥ä½ç½®";
        setText('ipLine', loc.ip);
        setText('placeBadge', regions.join(' Â· '));
        setText('headline', `${city} Â· ä»Šæ—¥çŠ¶å†µ`);

        const weather = await (await fetch(`${WEATHER_BASE}${encodeURIComponent(city)}?format=j1&lang=zh`)).json();
        render(weather);
        setTimeout(() => document.getElementById('overlay').classList.add('hidden'), 500);
      } catch (e) {
        document.getElementById('errBox').style.display = 'block';
        setText('errBox', `åŒæ­¥å¤±è´¥: ${e.message}`);
      }
    }

    function codeToEmoji(code) {
      const c = String(code);
      if (c.startsWith("1")) return "â˜€ï¸";
      if (c.startsWith("2")) return "â›ˆï¸";
      if (c.startsWith("3")) return "ğŸŒ§ï¸";
      return "â›…";
    }

    function render(w) {
      const cur = w.current_condition[0];
      const today = w.weather[0];
      setText('tempNow', `${cur.temp_C}Â°`);
      setText('feelNow', `ä½“æ„Ÿ ${cur.FeelsLikeC}Â° Â· æ¹¿åº¦ ${cur.humidity}%`);
      setText('condNow', cur.weatherDesc[0].value);
      setText('emojiIcon', codeToEmoji(cur.weatherCode));
      setText('windNow', `${cur.windspeedKmph}km/h`);
      setText('windHint', `é£å‘: ${cur.winddir16Point}`);
      setText('rainNow', `${today.hourly[0].chanceofrain}%`);
      setText('visNow', `${cur.visibility}km`);
      setText('hiLo', `${today.maxtempC}Â° / ${today.mintempC}Â°`);
      setText('pressure', `${cur.pressure}hPa`);
      setText('cloud', `${cur.cloudcover}%`);
      setText('sun', `${today.astronomy[0].sunrise} / ${today.astronomy[0].sunset}`);
      setText('moon', today.astronomy[0].moon_phase);
      
      const t = parseInt(cur.temp_C);
      setText('adviceTitle', t > 28 ? "å»ºè®®é¿æš‘" : t > 15 ? "æ°”æ¸©èˆ’é€‚" : "æ³¨æ„ä¿æš–");
      setText('adviceText', `å½“å‰å®æ—¶è§‚æµ‹æ—¶é—´: ${cur.observation_time}`);

      const days = document.getElementById('days');
      days.innerHTML = '';
      w.weather.slice(1,3).forEach(d => {
        const pick = d.hourly[4]; 
        const div = document.createElement('div');
        div.className = 'day';
        div.innerHTML = `
          <div class="top">
            <div class="date">${d.date}</div>
            <div style="font-size:12px; color:var(--muted);">${pick.weatherDesc[0].value}</div>
          </div>
          <div class="mid">
            <div>
              <div class="t">${d.avgtempC}Â°</div>
              <div class="range">æœ€é«˜ ${d.maxtempC}Â° / æœ€ä½ ${d.mintempC}Â°</div>
            </div>
            <div class="icon" style="width:50px; height:50px; font-size:32px;">${codeToEmoji(pick.weatherCode)}</div>
          </div>
          <div class="bot">
            <div class="chip"><span>é™é›¨æ¦‚ç‡</span><b>${pick.chanceofrain}%</b></div>
            <div class="chip"><span>å¹³å‡æ¹¿åº¦</span><b>${pick.humidity}%</b></div>
            <div class="chip"><span>ä¸­åˆé£é€Ÿ</span><b>${pick.windspeedKmph}k/h</b></div>
            <div class="chip"><span>èƒ½è§åº¦</span><b>${pick.visibility}km</b></div>
          </div>
        `;
        days.appendChild(div);
      });
    }

    document.getElementById('scrollHint').onclick = () => document.getElementById('future').scrollIntoView({behavior:'smooth'});
    init();
  </script>
</body>
</html>
